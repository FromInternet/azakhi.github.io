<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PoP Character Creator</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <style type="text/css">
        .table thead th {
            font-size: 12px;
        }
        .table td {
            text-align: center;
        }
    </style>
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script type="text/javascript">
        $( document ).ready(function() {
            var attrs = ["Strength", "Agility", "Intelligence", "Charisma"];
            var skills = ["Ironflesh", "Power Strike", "Power Throw", "Power Draw", "Weapon Master", "Shield", "Athletics", "Riding", "Horse Archery", "Looting", "Trainer", "Tracking", "Tactics", "Path-finding", "Spotting", "Inventory Managment", "Wound Treatment", "Surgery", "First Aid", "Engineer", "Persuasion", "Prisoner Management", "Leadership", "Trade"];
            var base = {
                        attrs: [6, 5, 4, 5],
                        skills: [0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 1, 0]
                    };
            var stages = [
                [
                    {
                        text: "Male",
                        depends: -1,
                        attrs: [1, 0, 0, 2],
                        skills: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
                    },
                    {
                        text: "Female",
                        depends: -1,
                        attrs: [0, 2, 1, 0],
                        skills: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
                    }
                ],
                [
                    {
                        text: "A minor noble",
                        depends: 0,
                        attrs: [
                            [1, 0, 2, 2],
                            [0, 0, 2, 3]
                        ],
                        skills: [
                            [0, 2, 0, 0, 1, 2, 0, 2, 0, 0, 0, 0, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 3, 0],
                            [0, 1, 0, 0, 0, 0, 0, 2, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 2, 0, 4, 0, 2, 0]
                        ]
                    },
                    {
                        text: "A merchant ship captain",
                        depends: -1,
                        attrs: [0, 0, 2, 4],
                        skills: [0, 1, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 2, 0, 3, 0, 0, 0, 0, 1, 0, 0, 3]
                    },
                    {
                        text: "A former knight",
                        depends: -1,
                        attrs: [3, 2, 0, 1],
                        skills: [1, 2, 0, 0, 1, 1, 1, 2, 0, 0, 3, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
                    },
                    {
                        text: "A retired noble adventurert",
                        depends: -1,
                        attrs: [2, 2, 2, 0],
                        skills: [0, 2, 0, 1, 1, 0, 1, 2, 0, 2, 0, 1, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0]
                    },
                    {
                        text: "A wandering nomad clan leader",
                        depends: 0,
                        attrs: [
                            [3, 2, 1, 0],
                            [1, 2, 2, 1]
                        ],
                        skills: [
                            [0, 0, 0, 2, 0, 0, 1, 2, 2, 0, 0, 0, 0, 2, 2, 0, 0, 0, 1, 0, 0, 0, 0, 0],
                            [0, 0, 0, 0, 0, 0, 1, 3, 1, 1, 0, 1, 0, 3, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0]
                        ]
                    },
                    {
                        text: "A rough and mysterious figure",
                        depends: -1,
                        attrs: [0, 4, 2, 0],
                        skills: [0, 0, 3, 0, 0, 0, 2, 0, 0, 3, 0, 1, 2, 0, 2, 1, 0, 0, 1, 0, 1, 1, 0, 2]
                    },
                    {
                        text: "A respectable physician",
                        depends: -1,
                        attrs: [1, 2, 3, 0],
                        skills: [0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 2, 0, 1, 3, 3, 3, 0, 0, 1, 1, 2]
                    }
                ],
                [
                    {
                        text: "Arranged for you to serve a minor Barclay Noble",
                        depends: -1,
                        attrs: [1, 0, 1, 2],
                        skills: [0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 3, 0, 1, 0]
                    },
                    {
                        text: "Sent you to be an apprentice to the local guild craftsman",
                        depends: -1,
                        attrs: [1, 0, 2, 1],
                        skills: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 0, 0, 0, 2, 0, 0, 0, 1]
                    },
                    {
                        text: "Put you in the care of a successful merchant",
                        depends: -1,
                        attrs: [0, 0, 3, 1],
                        skills: [0, 0, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 2, 0, 0, 0, 0, 0, 0, 0, 1]
                    },
                    {
                        text: "Left you to fend for yourself",
                        depends: -1,
                        attrs: [0, 2, 2, 0],
                        skills: [1, 0, 0, 0, 0, 0, 1, 0, 0, 2, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0]
                    },
                    {
                        text: "Sent you out on your own to hunt in the wilds",
                        depends: -1,
                        attrs: [2, 2, 0, 0],
                        skills: [0, 0, 0, 0, 0, 0, 0, 0, 2, 0, 0, 1, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0]
                    }
                ],
                [
                    {
                        text: "A squire/A lady-in-waiting",
                        depends: 0,
                        attrs: [
                            [1, 1, 0, 0],
                            [0, 0, 1, 1]
                        ],
                        skills: [
                            [0, 2, 0, 0, 1, 2, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0],
                            [0, 0, 0, 0, 0, 0, 0, 2, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 2, 0, 2, 0]
                        ]
                    },
                    {
                        text: "A bard",
                        depends: -1,
                        attrs: [0, 0, 0, 2],
                        skills: [0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 3, 0, 2, 0]
                    },
                    {
                        text: "A scholar at a local Barclay university",
                        depends: -1,
                        attrs: [0, 0, 2, 0],
                        skills: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 2, 2, 0, 0, 0, 0, 0]
                    },
                    {
                        text: "A self employed merchant",
                        depends: -1,
                        attrs: [0, 0, 1, 1],
                        skills: [0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 1, 0, 2, 0, 0, 0, 0, 1, 0, 0, 2]
                    },
                    {
                        text: "An engineer and builder",
                        depends: -1,
                        attrs: [1, 0, 1, 0],
                        skills: [0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 2, 0, 0, 2, 0, 0, 0, 3, 0, 0, 0, 0]
                    },
                    {
                        text: "A tracker and hunter",
                        depends: -1,
                        attrs: [1, 1, 0, 0],
                        skills: [0, 0, 0, 2, 0, 0, 2, 1, 0, 0, 0, 1, 0, 0, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0]
                    }
                ],
                [
                    {
                        text: "You must right a wrong done to you",
                        depends: 3,
                        attrs: [
                            [2, 0, 1, 0],
                            [2, 0, 1, 0],
                            [2, 0, 1, 0],
                            [2, 0, 1, 0],
                            [2, 0, 1, 0],
                            [2, 0, 1, 0]
                        ],
                        skills: [
                            [0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                            [0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 2, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                            [0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 1, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                            [1, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                            [0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                            [0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0]
                        ]
                    },
                    {
                        text: "You received a message that your father has died",
                        depends: -1,
                        attrs: [0, 1, 0, 2],
                        skills: [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 0, 0, 0, 2, 0, 0, 0, 0, 0]
                    },
                    {
                        text: "A series of unfortunate events",
                        depends: 3,
                        attrs: [
                            [0, 3, 0, 0],
                            [0, 3, 0, 0],
                            [0, 3, 0, 0],
                            [0, 3, 0, 0],
                            [0, 3, 0, 0],
                            [0, 3, 0, 0]
                        ],
                        skills: [
                            [0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 3, 2, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                            [0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 1, 2, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0],
                            [0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 3, 2, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                            [0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 2, 1, 0, 0, 0, 0, 0, 0, 1, 0, 1],
                            [0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 2, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                            [0, 0, 0, 0, 0, 0, 0, 2, 0, 0, 0, 0, 1, 3, 1, 0, 0, 0, 0, 2, 0, 0, 0, 0]
                        ]
                    },
                    {
                        text: "Too many enemies that seek to end your life",
                        depends: 3,
                        attrs: [
                            [2, 0, 1, 0],
                            [2, 0, 1, 0],
                            [2, 0, 1, 0],
                            [2, 0, 1, 0],
                            [2, 0, 1, 0],
                            [2, 0, 1, 0]
                        ],
                        skills: [
                            [0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1],
                            [0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1],
                            [0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 1],
                            [0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 2, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1],
                            [0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 2, 0, 0, 1],
                            [0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 1]
                        ]
                    },
                    {
                        text: "A letter that changed your life forever",
                        depends: -1,
                        attrs: [0, 1, 2, 0],
                        skills: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
                    }
                ]
            ];
            
            // add headers
            var headers = "<th scope=\"col\">#</th>";
            for(var i = 0; i < attrs.length; i++) {
                headers += "<th scope=\"col\">" + attrs[i] + "</th>";
            }
            for(var i = 0; i < skills.length; i++) {
                headers += "<th scope=\"col\">" + skills[i] + "</th>";
            }
            
            $("#resTab > thead > tr").html(headers);
            
            // add base values
            var sttext = "";
            sttext += "<tr>";
            sttext += "<th scope=\"row\">Base</th>";
            for(var i = 0; i < base.attrs.length; i++) {
                sttext += "<td>" + base.attrs[i] + "</td>";
            }
            for(var i = 0; i < base.skills.length; i++) {
                sttext += "<td>" + ((base.skills[i] == 0) ? '' : base.skills[i]) + "</td>";
            }
            sttext += "</tr>";
            
            // add stages
            for(var i = 0; i < stages.length; i++) {
                sttext += "<tr>";
                sttext += "<th class=\"ft\" scope=\"row\">";
                sttext += "<select class=\"form-control\" id=\"stage" + i + "\">";
                sttext += "<option value=\"-1\">(Please select one)</option>";
                
                // add options
                for(var j = 0; j < stages[i].length; j++) {
                    sttext += "<option value=\"" + j + "\">" + stages[i][j].text + "</option>";
                }
                
                sttext += "</select>";
                sttext += "</th>";
                
                // add cells
                var total = attrs.length + skills.length;
                for(var j = 0; j < total; j++) {
                    sttext += "<td></td>";
                }
                sttext += "</tr>";
            }
            
            // add sum row
            sttext += "<tr>";
            sttext += "<th scope=\"row\">Total</th>";
            
            // add cells
            var total = attrs.length + skills.length;
            for(var j = 0; j < total; j++) {
                sttext += "<td></td>";
            }
            sttext += "</tr>";
            $('#resTab > tbody').html(sttext);
            
            // update values on change
            $('select').on('change', function() {
                var copyAttr = base.attrs.slice(0);
                var copySkill = base.skills.slice(0);
                
                for(var i = 0; i < stages.length; i++) {
                    var sel = $('#stage' + i).val();
                    var cells = $('#resTab > tbody > tr:nth-child(' + (i+2) + ') > td');
                    if(sel == -1) {
                        cells.each(function(n, item){
                            $(item).html('');
                        });
                    }
                    else {
                        var dep = stages[i][sel].depends;
                        var val = 0;
                        if(dep == -1) {
                            cells.each(function(n, item){
                                if(n < copyAttr.length) {
                                    val = stages[i][sel].attrs[n];
                                    copyAttr[n] += val;
                                }
                                else {
                                    val = stages[i][sel].skills[n - copyAttr.length];
                                    copySkill[n - copyAttr.length] += val;
                                }
                                if(val == 0)
                                    $(item).html('');
                                else
                                    $(item).html(val);
                            });
                        }
                        else {
                            var depSel = $('#stage' + dep).val();
                            if(depSel == -1) {
                                cells.each(function(n, item){
                                    $(item).html('');
                                });
                            }
                            else {
                                cells.each(function(n, item){
                                    if(n < copyAttr.length) {
                                        val = stages[i][sel].attrs[depSel][n];
                                        copyAttr[n] += val;
                                    }
                                    else {
                                        val = stages[i][sel].skills[depSel][n - copyAttr.length];
                                        copySkill[n - copyAttr.length] += val;
                                    }
                                    if(val == 0)
                                        $(item).html('');
                                    else
                                        $(item).html(val);
                                });
                            }
                        }
                    }
                }
                
                var cells = $('#resTab > tbody > tr:nth-child(' + (stages.length+2) + ') > td');
                cells.each(function(n, item){
                    if(n < copyAttr.length)
                        $(item).html((copyAttr[n] == 0) ? '' :  copyAttr[n]);
                    else {
                        var sum = copySkill[n - copyAttr.length];
                        if(sum == 0) {
                            $(item).html('');
                        }
                        else if(sum > 7) {
                            $(item).html(7 + " <span class=\"bg-danger\" title=\"Skills are limited at 7!\">-" + (sum - 7) + "</span>");
                        }
                        else {
                            $(item).html(sum);
                        }
                    }
                });
            });
        });
    </script>
</head>
<body>
    <p class="lead text-center">Mount & Blade: Warband Prophesy of Pendor (3.9) Character Creation Tool</p>
    <p class="lead text-center">Please create an issue on <a href="https://github.com/azakhi/azakhi.github.io" class="alert-link">Github page</a> if you find any problems</p>
    
    <table id="resTab" class="table table-bordered table-dark table-sm table-hover">
        <thead><tr></tr></thead>
        <tbody></tbody>
    </table>
</body>
</html>
